# 文件模块描述
## Camera_GreySensor模块
### 模块主控
M2Dock
### 模块外设
摄像头
灰度传感器
### 模块功能
1. 通过摄像头识别数字
2. 通过灰度传感器识别路线
3. 整理二者信息，做出路线运动决策
4. 通过串口发送决策信息
5. 接受来自ESP32的摄像头操作信息
### 模块通信
1. 串口通信：与ESP32通信
2. 接收灰度传感器信息，通过gpio自行设置时钟
### 语言
MaixPy
## CoreESP32模块
### 模块主控
ESP32
### 模块外设
1. MPU6050
2. 激光测距模块
3. OLED显示屏
4. 无线通信模块
### 模块功能
1. 通过MPU6050获取姿态信息
2. 通过激光测距获得距离信息
3. 通过OLED显示屏显示信息
4. 与其他设备（手机、小车）进行无线通信
5. 接收M2Dock的运动控制信息，发送摄像头控制信息
6. 发送信息给Arduino，控制电机和舵机，接收速度信息
### 模块通信
1. 串口通信：与Arduino通信，与M2Dock通信，与无线设备通信（可选）
2. I2C通信：与MPU6050通信，与测距模块通信
3. SPI通信：与OLED显示屏通信
### 语言
MicroPython
## MotionControl模块
### 模块主控
Arduino Uno
### 模块外设
1. 电机
2. 霍尔编码器
3. 舵机
### 模块功能
1. 通过霍尔编码器获取电机速度信息，通过PID控制电机速度
2. 利用PWM，控制电机速度
3. 利用I2C，控制舵机角度
4. 通过串口接收来自ESP32的运动控制信息
5. 通过串口发送电机速度信息
### 模块通信
1. 串口通信：与ESP32通信
2. I2C通信，与舵机通信
3. PWM控制电机
4. 霍尔编码器触发中断得到速度
### 语言
Arduino

## Sensors模块
Sensors模块作为ESP32的一部分，主要负责获取并解算传感器信息
# 通信规则
**通信流程按照ESP32为中心，以request-post模式轮询各个通信接口**
## 整体通信流程
1. ESP32打开SPI通信，向OLED屏幕发送显示信息，信息为上一轮收到的传感信息
2. ESP32打开I2C通信，获取MPU6050最新的姿态信息，包括角度、加速度等。
3. ESP32打开I2C通信，获取激光测距模块最新的距离信息。
4. ESP32打开串口通信，先后访问UART0（无线通信），UART1（M2Dock），UART2（Arduino）

## 串口规则
**通信的核心问题在于串口，协调缓冲问题，避免收发频率不一致造成信息积压**

### Arduino串口规则
1. Arduino串口等待POST标志
2. 收到POST标志后，接收接下来三个字节的信息，分别为运动指令，舵机1，舵机2
3. 发送速度数据
4. 等待100ms，再开始下一次监听
### M2Dock串口规则
1. M2Dock准备好灰度信息和照片识别信息，处理好
2. 检查是否收到CAM控制信息，如果没有，等待50ms
3. 发送POST标志，发送运动信息1字节
4. 延迟50ms
### ESP32串口规则——Arduino
1. ESP32准备好姿态信息和距离信息，处理好，准备电机、舵机信息
2. 发送POST标志给Arduino，发送3字节信息
3. 等待100ms
4. 接收速度信息
### ESP32串口规则——M2Dock
1. 等待来自M2的POST标志
2. 收到post后，接收1Byte运动控制信息，延迟50ms
3. 如果有cam控制需要发送，发送POST标志，发送CAM控制信息
4. 延迟50ms
